# Shell Script Review Skill

Bashシェルスクリプト（`.sh`ファイル）を包括的にレビューするためのスキルです。

## トリガー条件

以下の場合に自動的にレビューを実行します:
- `.sh`ファイルを新規作成した時
- `.sh`ファイルを編集した時
- shebang `#!/bin/bash` を含むファイルを編集した時

## レビュー観点

### 1. 構文エラー
- シェル構文の誤り
- 括弧やクォートの不一致
- 変数名の誤り
- 予約語の誤用

### 2. ベストプラクティス
- ShellCheck準拠の推奨事項
- エラーハンドリング（`set -euo pipefail`など）
- 変数のクォート
- コマンド置換の適切な使用
- パイプライン処理の安全性

### 3. セキュリティ
- コマンドインジェクションのリスク
- パストラバーサルの脆弱性
- 環境変数の安全な使用
- 一時ファイルの安全な作成
- 権限関連の問題
- ハードコードされた認証情報

### 4. パフォーマンス
- 不要なサブシェル起動
- 非効率なループ処理
- 外部コマンドの過剰な使用
- パイプラインの最適化

### 5. 可読性・保守性
- 適切なコメント
- 関数の分割
- マジックナンバーの回避
- 変数名の明確性

## 出力形式

レビュー結果は以下の形式で出力します:

```markdown
## Shell Script レビュー結果

### 🔴 Critical（重大）
即座に修正が必要な問題

**ファイル名:行番号**
- 問題: [問題の説明]
- 影響: [セキュリティリスク/データ損失など]
- 修正案:
  ```bash
  # 修正後のコード
  ```

### 🟡 Warning（警告）
修正を推奨する問題

**ファイル名:行番号**
- 問題: [問題の説明]
- 理由: [なぜ修正すべきか]
- 修正案:
  ```bash
  # 修正後のコード
  ```

### 🔵 Info（情報）
より良いコードのための提案

**ファイル名:行番号**
- 提案: [改善提案]
- 修正案:
  ```bash
  # 修正後のコード
  ```

### ✅ Summary（サマリー）
- Total Issues: X件（Critical: X, Warning: X, Info: X）
- Overall Assessment: [Good/Needs Improvement/Critical Issues Found]
```

## レビューの実行方法

1. スクリプト全体を読み込む
2. 上記の5つの観点で分析
3. 問題を重要度で分類（Critical > Warning > Info）
4. 各問題に対して具体的な修正案を提示
5. サマリーで全体評価を提供

## 重要度の判定基準

**🔴 Critical:**
- セキュリティ脆弱性
- データ損失の可能性
- システムクラッシュの危険性
- 構文エラー

**🟡 Warning:**
- エラーハンドリング不足
- ベストプラクティス違反
- パフォーマンス問題
- 移植性の問題

**🔵 Info:**
- コードスタイル
- 可読性の改善
- より良いアプローチの提案

## ベストプラクティス

- 必ず具体的な修正案を提示する
- 問題の「なぜ」を説明する
- 行番号を明記する
- 修正前後のコードを示す
- 全体的な評価を提供する
- 問題がない場合も「問題なし」と明示する

## 使用例

```bash
#!/bin/bash
# このファイルを保存または編集すると自動的にレビューが実行される

filename=$1
rm -rf /$filename  # Criticalな問題を検出
```

上記のような危険なコードを検出し、具体的な修正案を提示します。
